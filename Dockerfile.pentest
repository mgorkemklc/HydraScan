FROM kalilinux/kali-rolling

ENV DEBIAN_FRONTEND=noninteractive

# 1. TEMEL ARAÇLAR VE BAĞIMLILIKLAR
RUN apt-get update && apt-get install -y \
    python3 python3-pip python3-venv \
    nmap nikto sqlmap whois dnsutils \
    gobuster hydra \
    amass \
    curl wget git unzip make gcc \
    pciutils net-tools iputils-ping \
    libpcap-dev \
    default-jdk jadx \
    apktool \
    dirb \
    wordlists \
    gzip \
    golang \
    sslscan \
    && rm -rf /var/lib/apt/lists/*

# 2. GO ORTAMI VE PATH AYARI
ENV GOPATH=/root/go
ENV PATH=$PATH:$GOPATH/bin:/usr/local/go/bin

# 3. WORDLIST HAZIRLIĞI
RUN if [ -f /usr/share/wordlists/rockyou.txt.gz ]; \
    then \
        gunzip /usr/share/wordlists/rockyou.txt.gz; \
    fi

# 4. MODERN ARAÇLAR (HAZIR BINARY İNDİRME YÖNTEMİ)
# Bu yöntem 'go install' kullanmaz, direkt çalışan dosyayı indirir.
# Böylece Gitea/HTTP2 hataları tamamen baypas edilir.

# Dalfox (Go install ile hata vermiyor, kalabilir)
RUN go install github.com/hahwul/dalfox/v2@latest

# Nuclei (Binary Kurulum) - Kaynak koddan derleme yerine direkt indiriyoruz
RUN wget https://github.com/projectdiscovery/nuclei/releases/download/v3.3.6/nuclei_3.3.6_linux_amd64.zip \
    && unzip nuclei_3.3.6_linux_amd64.zip \
    && mv nuclei /usr/local/bin/ \
    && rm nuclei_3.3.6_linux_amd64.zip

# Subfinder (Binary Kurulum)
RUN wget https://github.com/projectdiscovery/subfinder/releases/download/v2.6.6/subfinder_2.6.6_linux_amd64.zip \
    && unzip subfinder_2.6.6_linux_amd64.zip \
    && mv subfinder /usr/local/bin/ \
    && rm subfinder_2.6.6_linux_amd64.zip

# 5. PYTHON ARAÇLARI
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"
ENV PATH="/root/go/bin:${PATH}"
RUN pip install --upgrade pip setuptools wheel
RUN pip install wapiti3 commix apkleaks

WORKDIR /app
CMD ["/bin/bash"]