# Dockerfile.pentest

FROM kalilinux/kali-rolling

# 1. Sistem güncellemeleri ve temel araçlar
# 'make' ve 'gcc' eklendi (Kiterunner derlemesi için gerekli)
RUN apt-get update && apt-get install -y \
    python3 python3-pip python3-venv \
    nmap nikto sqlmap whois dnsutils \
    gobuster hydra wapiti \
    curl wget git unzip make gcc \
    pciutils net-tools iputils-ping \
    libpcap-dev \
    default-jdk jadx \
    golang \
    && rm -rf /var/lib/apt/lists/*

# 2. Go Ortamı Ayarları
ENV GOPATH=/root/go
ENV PATH=$PATH:$GOPATH/bin
# Proxy sorunlarını aşmak için direct mod
ENV GOPROXY=direct

# 3. Modern Araçların Kurulumu (Go ile)
RUN go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest
RUN go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
RUN go install -v github.com/owasp-amass/amass/v3/...@latest
RUN go install github.com/hahwul/dalfox/v2@latest

# 4. Kiterunner (Git Clone + Make Build Yöntemi - KESİN ÇÖZÜM)
RUN git clone https://github.com/assetnote/kiterunner.git /opt/kiterunner && \
    cd /opt/kiterunner && \
    make build && \
    ln -s /opt/kiterunner/dist/kr /usr/local/bin/kr

# 5. Diğer Araçlar
RUN curl -sSfL https://raw.githubusercontent.com/trufflesecurity/trufflehog/main/scripts/install.sh | sh -s -- -b /usr/local/bin

# 6. Python Araçları
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"
RUN pip install --upgrade pip setuptools wheel
RUN pip install commix apkleaks

WORKDIR /app
CMD ["/bin/bash"]