# Dockerfile.pentest

FROM kalilinux/kali-rolling

ENV DEBIAN_FRONTEND=noninteractive

# 1. TEMEL ARAÇLAR VE BAĞIMLILIKLAR
# DÜZELTME: 'golang' listeye geri eklendi. (Dalfox kurulumu için şart)
RUN apt-get update && apt-get install -y \
    python3 python3-pip python3-venv \
    nmap nikto sqlmap whois dnsutils \
    gobuster hydra \
    amass \
    curl wget git unzip make gcc \
    pciutils net-tools iputils-ping \
    libpcap-dev \
    default-jdk jadx \
    apktool \
    dirb \
    wordlists \
    gzip \
    golang \
    sslscan \
    && rm -rf /var/lib/apt/lists/*

# 2. GO ORTAMI VE PATH AYARI
ENV GOPATH=/root/go
ENV PATH=$PATH:$GOPATH/bin:/usr/local/go/bin
# DNS/Network sorunlarını aşmak için direct mod
ENV GOPROXY=direct

# 3. WORDLIST HAZIRLIĞI
RUN if [ -f /usr/share/wordlists/rockyou.txt.gz ]; then \
        gunzip /usr/share/wordlists/rockyou.txt.gz; \
    fi

# 4. MODERN ARAÇLAR (Go ile Kurulum)
# Artık 'golang' yüklü olduğu için bu komut hata vermeyecek.
RUN go install github.com/hahwul/dalfox/v2@latest
RUN go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
RUN go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest

# 5. PYTHON ARAÇLARI
RUN python3 -m venv /opt/venv
ENV PATH="/opt/venv/bin:$PATH"
ENV PATH="/root/go/bin:${PATH}"
RUN pip install --upgrade pip setuptools wheel
RUN pip install wapiti3 commix apkleaks

WORKDIR /app
CMD ["/bin/bash"]